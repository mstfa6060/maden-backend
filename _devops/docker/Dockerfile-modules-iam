# 1ï¸âƒ£ Temel runtime imajÄ± (sadece Ã§alÄ±ÅŸtÄ±rma iÃ§in)
FROM mcr.microsoft.com/dotnet/aspnet:8.0 AS base
WORKDIR /app
EXPOSE 8080

# 2ï¸âƒ£ Build aÅŸamasÄ± (kodun derlenmesi iÃ§in SDK kullanÄ±lÄ±yor)
FROM mcr.microsoft.com/dotnet/sdk:8.0 AS build
WORKDIR /src

# ğŸ”„ Proje dosyalarÄ±nÄ±n tamamÄ±nÄ± kopyala
COPY . .

# ğŸ”§ BaÄŸÄ±mlÄ±lÄ±klarÄ± indir
RUN dotnet restore ./Hirovo.sln

# ğŸ› ï¸ Publish iÅŸlemi â€” âš ï¸ yazÄ±m hatasÄ± vardÄ±: publis â†’ publish
RUN dotnet publish ./BaseModules/IAM/BaseModules.IAM.Api/BaseModules.IAM.Api.csproj -c Release -o /app/publish

# 3ï¸âƒ£ Son aÅŸama â€” sadece Ã§Ä±ktÄ± dosyalarÄ± kalacak
FROM base AS final
WORKDIR /app

# ğŸ›¡ï¸ appsettings.json'u da dahil et (opsiyonel: zaten publish iÃ§ine kopyalanmÄ±ÅŸ olabilir)
COPY ./BaseModules/IAM/BaseModules.IAM.Api/appsettings.json ./BaseModules/IAM/BaseModules.IAM.Api/appsettings.json

# ğŸ—‚ï¸ Build aÅŸamasÄ±ndan publish klasÃ¶rÃ¼nÃ¼ al
COPY --from=build /app/publish .

# ğŸš€ BaÅŸlangÄ±Ã§ komutu
ENTRYPOINT ["dotnet", "BaseModules.IAM.Api.dll"]
